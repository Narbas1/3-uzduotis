cmake_minimum_required(VERSION 3.10)
project(MyApp VERSION 1.0 LANGUAGES CXX)

# ——————————————————————————————
# 1) C++ settings
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# ——————————————————————————————
# 2) Where to find headers
set(INCLUDE_DIR "${PROJECT_SOURCE_DIR}/vector/include")
set(DOCTEST_DIR "${PROJECT_SOURCE_DIR}/tests/third_party")

# ——————————————————————————————
# 3) Build core_lib from your .cpp (excluding main.cpp)
file(GLOB CORE_SRC
    "${PROJECT_SOURCE_DIR}/vector/source/*.cpp"
)
list(REMOVE_ITEM CORE_SRC
    "${PROJECT_SOURCE_DIR}/vector/source/main.cpp"
)

add_library(core_lib ${CORE_SRC})
target_include_directories(core_lib
    PUBLIC ${INCLUDE_DIR}
)

# ——————————————————————————————
# 4) Build the main executable
add_executable(vector
    "${PROJECT_SOURCE_DIR}/vector/source/main.cpp"
)
target_link_libraries(vector
    PRIVATE core_lib
)

# ——————————————————————————————
# 5) Unit tests (doctest)
option(BUILD_TESTS "Build the doctest unit tests" ON)
if (BUILD_TESTS)
  enable_testing()

  add_executable(tests
    "${PROJECT_SOURCE_DIR}/tests/tests.cpp"
  )
  target_include_directories(tests
    PRIVATE
      ${INCLUDE_DIR}    # your vector headers
      ${DOCTEST_DIR}    # where doctest.h lives
  )
  target_link_libraries(tests
    PRIVATE core_lib
  )

  add_test(
    NAME run_doctests
    COMMAND tests
  )
endif()
